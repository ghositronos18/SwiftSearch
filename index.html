<!DOCTYPE html>

<title>Swift Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#0b0e14;
  color:#e8eaed;
}
.container{
  max-width:760px;
  margin:14vh auto;
  text-align:center;
}
.logo{
  font-size:2.6rem;
  font-weight:600;
  margin-bottom:26px;
}
.search{
  display:flex;
  gap:10px;
}
input{
  flex:1;
  padding:14px 18px;
  font-size:1rem;
  border-radius:24px;
  border:none;
  outline:none;
  background:#1f2937;
  color:white;
}
button{
  width:46px;
  border-radius:50%;
  border:none;
  background:#2563eb;
  color:white;
  cursor:pointer;
  font-size:1.1rem;
}
.results{
  margin-top:22px;
  text-align:left;
}
.card{
  background:#111827;
  border-radius:16px;
  padding:16px;
  margin-bottom:14px;
}
.note{
  font-size:.8rem;
  color:#9ca3af;
}
.keybox{
  background:#111827;
  border-radius:16px;
  padding:16px;
  margin-bottom:14px;
}
.keybox input{
  width:100%;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="container">
  <div class="logo">Swift Search</div>

  <div class="search">
    <input id="q" placeholder="Search, ask AI, or play music">
    <button id="mic">ðŸŽ¤</button>
  </div>

  <div class="results" id="results"></div>
</div>

<script>
const input = document.getElementById("q");
const results = document.getElementById("results");


let GEMINI_KEY = localStorage.getItem("GEMINI_KEY");

function showKeyInput(){
  results.innerHTML = `
    <div class="keybox">
      <b>Enter Gemini API Key</b>
      <p class="note">Stored locally in your browser</p>
      <input id="keyInput" placeholder="AIza..." />
      <button style="margin-top:10px" onclick="saveKey()">Save</button>
    </div>
  `;
}

function saveKey(){
  const k = document.getElementById("keyInput").value.trim();
  if(!k) return;
  localStorage.setItem("GEMINI_KEY",k);
  GEMINI_KEY = k;
  results.innerHTML = "";
}


function openGoogle(q){
  window.open(
    `https://www.google.com/search?q=${encodeURIComponent(q)}`,
    "_blank"
  );
}
function openYouTube(q){
  window.open(
    `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`,
    "_blank"
  );
}
function openYouTubeMusic(q){
  window.open(
    `https://music.youtube.com/search?q=${encodeURIComponent(q)}`,
    "_blank"
  );
}
function openSpotify(q){
  window.open(
    `https://open.spotify.com/search/${encodeURIComponent(q)}`,
    "_blank"
  );
}
function openMail(){
  window.open("https://mail.google.com","_blank");
}

async function askGemini(prompt){
  if(!GEMINI_KEY){
    showKeyInput();
    return null;
  }

  const res = await fetch(
    `https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${GEMINI_KEY}`,
    {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        contents:[{ parts:[{ text: prompt }] }]
      })
    }
  );

  const data = await res.json();
  return data?.candidates?.[0]?.content?.parts?.[0]?.text || null;
}


async function handle(query){
  const q = query.toLowerCase().trim();
  results.innerHTML = "";

  /* ðŸŽµ MUSIC INTENT */
  if (q.startsWith("play ")) {
    const song = query.replace(/^play\s+/i,"");

    if (q.includes("youtube music")) return openYouTubeMusic(song);
    if (q.includes("youtube")) return openYouTube(song);
    if (q.includes("spotify")) return openSpotify(song);

    return openSpotify(song);
  }

  /* DIRECT SERVICES */
  if (q.includes("youtube")) return openYouTube(query);
  if (q.includes("spotify")) return openSpotify(query);
  if (q.includes("gmail") || q.includes("email")) return openMail();

  if (q.startsWith("open ")) {
    const site = q.replace("open ","").replace(/\s+/g,"");
    window.open(`https://${site}.com`,"_blank");
    return;
  }

  /* AI + WEB FUSION */
  results.innerHTML = `
    <div class="card">
      <b>AI Overview</b>
      <p class="note">Thinkingâ€¦</p>
    </div>
  `;

  const aiAnswer = await askGemini(query);

  results.innerHTML = `
    <div class="card">
      <b>AI Overview</b>
      <p>${aiAnswer || "No AI response available."}</p>
      <div class="note">Web results opened in new tab</div>
    </div>
  `;

  openGoogle(query);
}

input.addEventListener("keydown",e=>{
  if (e.key === "Enter") handle(input.value);

  if (e.key === "/") {
    e.preventDefault();
    input.focus();
  }

  if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "l") {
    e.preventDefault();
    input.focus();
  }

  if (e.key === "Escape") {
    input.value = "";
    input.blur();
  }
});
</script>

</body>
</html>
