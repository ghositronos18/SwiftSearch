<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Swift Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Favicon - Tab Logo -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
<link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#0b0e14;
  color:#e8eaed;
}
.container{
  max-width:760px;
  margin:14vh auto;
  text-align:center;
}
.logo{
  font-size:2.6rem;
  font-weight:600;
  margin-bottom:26px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}
.logo .ai-badge{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding:4px 12px;
  border-radius:20px;
  font-size:0.8rem;
  font-weight:500;
}
.search-wrapper{
  position:relative;
  display:flex;
  gap:10px;
}
.search-box{
  flex:1;
  position:relative;
}
input{
  width:100%;
  padding:14px 80px 14px 18px;
  font-size:1rem;
  border-radius:24px;
  border:none;
  outline:none;
  background:#1f2937;
  color:white;
  box-sizing:border-box;
}
.search-controls{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  display:flex;
  gap:8px;
}
.search-btn{
  background:none;
  border:none;
  color:#9ca3af;
  cursor:pointer;
  font-size:1.2rem;
  padding:4px;
  transition:all 0.2s;
  display:flex;
  align-items:center;
  justify-content:center;
  width:32px;
  height:32px;
  border-radius:50%;
}
.search-btn:hover{
  background:#374151;
}
.search-btn.text-search:hover{
  color:#2563eb;
}
.search-btn.voice-search:hover{
  color:#3b82f6;
}
.search-btn.voice-search.listening{
  color:#ef4444;
  background:#1f2937;
  animation:pulse 1.5s infinite;
}
.search-btn.swift-ai:hover{
  color:#8b5cf6;
  background:linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
}
.search-btn.swift-ai.active{
  color:#8b5cf6;
  background:linear-gradient(135deg, #667eea40 0%, #764ba240 100%);
  animation:glow 2s infinite;
}
.search-btn.file-search:hover{
  color:#10b981;
}
.search-actions{
  display:flex;
  gap:8px;
}
.action-btn{
  width:46px;
  height:46px;
  border-radius:50%;
  border:none;
  background:#2563eb;
  color:white;
  cursor:pointer;
  font-size:1.1rem;
  display:flex;
  align-items:center;
  justify-content:center;
}
.action-btn:hover{
  background:#1d4ed8;
}
button.clear-key{
  width:auto;
  padding:10px 16px;
  border-radius:24px;
  background:#dc2626;
  font-size:0.9rem;
  margin-top:10px;
  border:none;
  color:white;
  cursor:pointer;
}
button.clear-key:hover{
  background:#b91c1c;
}
.results{
  margin-top:22px;
  text-align:left;
}
.card{
  background:#111827;
  border-radius:16px;
  padding:16px;
  margin-bottom:14px;
}
.note{
  font-size:.8rem;
  color:#9ca3af;
}
.keybox{
  background:#111827;
  border-radius:16px;
  padding:16px;
  margin-bottom:14px;
}
.keybox input{
  width:100%;
  margin-top:10px;
  padding:12px 16px;
}
.history-item{
  padding:8px 12px;
  margin:4px 0;
  background:#1f2937;
  border-radius:8px;
  cursor:pointer;
  transition:background 0.2s;
}
.history-item:hover{
  background:#374151;
}
.loading-spinner{
  border:3px solid #1f2937;
  border-top:3px solid #2563eb;
  border-radius:50%;
  width:24px;
  height:24px;
  animation:spin 1s linear infinite;
  margin:10px auto;
}
.swift-ai-response{
  border-left:4px solid #8b5cf6;
  padding-left:12px;
  margin:10px 0;
}
.swift-ai-header{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:8px;
}
.swift-ai-icon{
  width:24px;
  height:24px;
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:0.9rem;
}
@keyframes spin{
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}
@keyframes pulse{
  0%,100%{opacity:1;}
  50%{opacity:0.6;}
}
@keyframes glow{
  0%,100%{box-shadow:0 0 5px #8b5cf6;}
  50%{box-shadow:0 0 15px #8b5cf6;}
}
.music-options{
  display:flex;
  gap:10px;
  margin-top:10px;
  flex-wrap:wrap;
}
.music-btn{
  padding:8px 16px;
  background:#374151;
  border-radius:20px;
  font-size:0.9rem;
  cursor:pointer;
  transition:background 0.2s;
  border:none;
  color:white;
}
.music-btn:hover{
  background:#4b5563;
}
.voice-status{
  position:fixed;
  top:20px;
  right:20px;
  background:#111827;
  padding:12px 16px;
  border-radius:12px;
  display:none;
  align-items:center;
  gap:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  z-index:1000;
}
.swift-ai-status{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.voice-dot{
  width:10px;
  height:10px;
  background:#ef4444;
  border-radius:50%;
  animation:pulse 1s infinite;
}
.swift-ai-dot{
  background:#8b5cf6;
}
.voice-text{
  font-size:0.9rem;
}
.file-services{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));
  gap:10px;
  margin-top:10px;
}
.file-service{
  background:#1f2937;
  border-radius:12px;
  padding:12px;
  text-align:center;
  cursor:pointer;
  transition:background 0.2s, transform 0.2s;
}
.file-service:hover{
  background:#374151;
  transform:translateY(-2px);
}
.file-service i{
  font-size:1.5rem;
  margin-bottom:8px;
  display:block;
}
.file-service-name{
  font-size:0.9rem;
  font-weight:500;
}
.file-service-desc{
  font-size:0.75rem;
  color:#9ca3af;
  margin-top:4px;
}
.file-upload-area{
  border:2px dashed #374151;
  border-radius:12px;
  padding:30px 20px;
  text-align:center;
  margin-top:15px;
  cursor:pointer;
  transition:border-color 0.2s;
}
.file-upload-area:hover{
  border-color:#3b82f6;
}
.file-upload-area.dragover{
  border-color:#10b981;
  background:#064e3b20;
}
.upload-icon{
  font-size:2rem;
  margin-bottom:10px;
}
#fileList{
  margin-top:15px;
  max-height:200px;
  overflow-y:auto;
}
.file-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 12px;
  background:#1f2937;
  border-radius:8px;
  margin-bottom:6px;
}
.file-name{
  flex:1;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.file-size{
  font-size:0.8rem;
  color:#9ca3af;
  margin-left:10px;
}
.file-actions{
  display:flex;
  gap:6px;
}
.file-action-btn{
  background:none;
  border:none;
  color:#9ca3af;
  cursor:pointer;
  font-size:0.9rem;
  padding:2px 6px;
}
.file-action-btn:hover{
  color:#3b82f6;
}
.service-modal{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.8);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
}
.modal-content{
  background:#111827;
  border-radius:16px;
  padding:20px;
  max-width:500px;
  width:90%;
  max-height:80vh;
  overflow-y:auto;
}
.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}
.modal-close{
  background:none;
  border:none;
  color:#9ca3af;
  font-size:1.5rem;
  cursor:pointer;
  padding:0;
  width:30px;
  height:30px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.swift-ai-controls{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.swift-ai-btn{
  padding:8px 16px;
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius:20px;
  border:none;
  color:white;
  cursor:pointer;
  font-size:0.9rem;
  display:flex;
  align-items:center;
  gap:6px;
}
.swift-ai-btn:hover{
  opacity:0.9;
}
.swift-ai-btn.secondary{
  background:#374151;
}
.command-examples{
  background:#1f2937;
  border-radius:12px;
  padding:15px;
  margin-top:15px;
}
.command-examples h4{
  margin-top:0;
  margin-bottom:10px;
}
.command-item{
  padding:6px 0;
  border-bottom:1px solid #374151;
}
.command-item:last-child{
  border-bottom:none;
}
.command-cmd{
  color:#8b5cf6;
  font-weight:500;
}
.command-desc{
  color:#9ca3af;
  font-size:0.85rem;
  margin-left:8px;
}
.api-key-input{
  background:#1f2937;
  border:none;
  border-radius:8px;
  padding:10px;
  color:white;
  width:100%;
  margin-top:10px;
}
.api-options{
  display:flex;
  gap:10px;
  margin-top:15px;
}
.api-option-btn{
  flex:1;
  padding:10px;
  background:#1f2937;
  border:none;
  border-radius:8px;
  color:white;
  cursor:pointer;
  text-align:center;
}
.api-option-btn:hover{
  background:#374151;
}
.api-option-btn.active{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.ai-thinking{
  display:flex;
  align-items:center;
  gap:10px;
  margin:10px 0;
  padding:10px;
  background:#1f2937;
  border-radius:8px;
}
.typing-indicator{
  display:flex;
  gap:4px;
}
.typing-dot{
  width:8px;
  height:8px;
  background:#8b5cf6;
  border-radius:50%;
  animation:typing 1.4s infinite;
}
.typing-dot:nth-child(2){animation-delay:0.2s;}
.typing-dot:nth-child(3){animation-delay:0.4s;}
@keyframes typing{
  0%,60%,100%{transform:translateY(0);}
  30%{transform:translateY(-6px);}
}
@media(max-width:768px){
  .container{
    margin:8vh 16px;
  }
  .logo{
    font-size:2rem;
  }
  .search-wrapper{
    flex-direction:column;
  }
  .search-actions{
    width:100%;
    justify-content:center;
  }
  .action-btn{
    width:100%;
    border-radius:24px;
    height:46px;
  }
  .voice-status{
    top:10px;
    right:10px;
    left:10px;
  }
  input{
    padding-right:70px;
  }
  .file-services{
    grid-template-columns:repeat(2, 1fr);
  }
  .swift-ai-controls{
    flex-direction:column;
  }
  .api-options{
    flex-direction:column;
  }
}
</style>
</head>

<body>

<div class="container">
  <div class="logo">
    <span>üöÄ</span> Swift Search
    <span class="ai-badge">Swift AI</span>
  </div>

  <div class="search-wrapper">
    <div class="search-box">
      <input id="q" placeholder="Ask Swift AI, search, play music, or manage files...">
      <div class="search-controls">
        <button class="search-btn text-search" title="Text Search">üîç</button>
        <button class="search-btn swift-ai" title="Swift AI Assistant">‚ú®</button>
        <button class="search-btn voice-search" title="Voice Search">üé§</button>
        <button class="search-btn file-search" title="File Services">üìÅ</button>
      </div>
    </div>
    <div class="search-actions">
      <button class="action-btn" id="mainSearchBtn" title="Search">‚Üµ</button>
    </div>
  </div>

  <div id="clearKeyBtn"></div>

  <div class="voice-status" id="voiceStatus">
    <div class="voice-dot"></div>
    <div class="voice-text">Listening... Speak now</div>
  </div>

  <div class="voice-status swift-ai-status" id="swiftAiStatus" style="display:none">
    <div class="voice-dot swift-ai-dot"></div>
    <div class="voice-text">Swift AI is listening...</div>
  </div>

  <div class="results" id="results"></div>
</div>

<!-- File Services Modal -->
<div class="service-modal" id="fileModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 style="margin:0">File Services</h3>
      <button class="modal-close" onclick="closeFileModal()">√ó</button>
    </div>
    
    <div class="file-upload-area" id="uploadArea">
      <div class="upload-icon">üìÅ</div>
      <p>Drag & drop files here or click to browse</p>
      <input type="file" id="fileInput" multiple style="display:none">
      <p class="note">Supports images, documents, audio, and video files</p>
    </div>
    
    <div id="fileList"></div>
    
    <div class="file-services">
      <div class="file-service" onclick="searchOnService('googleDrive')">
        <i>üìÅ</i>
        <div class="file-service-name">Google Drive</div>
        <div class="file-service-desc">Cloud storage</div>
      </div>
      <div class="file-service" onclick="searchOnService('dropbox')">
        <i>üì¶</i>
        <div class="file-service-name">Dropbox</div>
        <div class="file-service-desc">File sharing</div>
      </div>
      <div class="file-service" onclick="searchOnService('onedrive')">
        <i>‚òÅÔ∏è</i>
        <div class="file-service-name">OneDrive</div>
        <div class="file-service-desc">Microsoft cloud</div>
      </div>
      <div class="file-service" onclick="searchOnService('icloud')">
        <i>üçé</i>
        <div class="file-service-name">iCloud</div>
        <div class="file-service-desc">Apple cloud</div>
      </div>
      <div class="file-service" onclick="openService('wetransfer')">
        <i>üì§</i>
        <div class="file-service-name">WeTransfer</div>
        <div class="file-service-desc">File transfer</div>
      </div>
      <div class="file-service" onclick="openService('figma')">
        <i>üé®</i>
        <div class="file-service-name">Figma</div>
        <div class="file-service-desc">Design files</div>
      </div>
      <div class="file-service" onclick="openService('github')">
        <i>üíª</i>
        <div class="file-service-name">GitHub</div>
        <div class="file-service-desc">Code files</div>
      </div>
      <div class="file-service" onclick="openService('notion')">
        <i>üìù</i>
        <div class="file-service-name">Notion</div>
        <div class="file-service-desc">Documents</div>
      </div>
    </div>
  </div>
</div>

<script>
const input = document.getElementById("q");
const results = document.getElementById("results");
const clearKeyBtn = document.getElementById("clearKeyBtn");
const swiftAiBtn = document.querySelector('.swift-ai');
const voiceBtn = document.querySelector('.voice-search');
const textSearchBtn = document.querySelector('.text-search');
const fileSearchBtn = document.querySelector('.file-search');
const mainSearchBtn = document.getElementById("mainSearchBtn");
const voiceStatus = document.getElementById("voiceStatus");
const swiftAiStatus = document.getElementById("swiftAiStatus");
const fileModal = document.getElementById("fileModal");
const uploadArea = document.getElementById("uploadArea");
const fileInput = document.getElementById("fileInput");
const fileList = document.getElementById("fileList");

/* ---------- AI CONFIGURATION ---------- */
let AI_API_KEY = localStorage.getItem("AI_API_KEY") || "";
let swiftAiMode = false;
let isAILoading = false;

// Simple AI knowledge base (pre-defined responses for common questions)
const AI_KNOWLEDGE_BASE = {
  greetings: [
    "Hello! I'm Swift AI, your personal assistant. How can I help you today?",
    "Hi there! Ready to assist you with anything you need.",
    "Hey! Swift AI here. What can I do for you?",
    "Greetings! I'm your Swift AI assistant. How can I be of service?"
  ],
  
  questions: {
    "what is your name": "I'm Swift AI, your personal voice assistant!",
    "who created you": "I was created by the Swift Search team to help users with search, information, and tasks.",
    "what can you do": "I can answer questions, tell jokes, calculate math, help with searches, play music, manage files, and much more!",
    "how are you": "I'm doing great, thanks for asking! Always ready to help.",
    "what time is it": `The current time is ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}.`,
    "what is the weather": "I can't check real-time weather, but you can search 'weather' in the search bar to get current conditions.",
    "what is swift search": "Swift Search is an all-in-one search platform with AI assistant, voice search, music playback, and file management capabilities.",
    "who are you": "I'm Swift AI, your intelligent assistant integrated into Swift Search. I can help you with various tasks and answer your questions!"
  },
  
  jokes: [
    "Why don't scientists trust atoms? Because they make up everything!",
    "Why did the scarecrow win an award? Because he was outstanding in his field!",
    "What do you call a fake noodle? An impasta!",
    "Why did the coffee file a police report? It got mugged!",
    "What's orange and sounds like a parrot? A carrot!",
    "Why don't eggs tell jokes? They'd crack each other up!",
    "What do you call a bear with no teeth? A gummy bear!",
    "Why did the math book look so sad? Because it had too many problems!"
  ],
  
  facts: [
    "Did you know? Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still perfectly good to eat.",
    "Fun fact: Octopuses have three hearts. Two pump blood to the gills, while the third pumps it to the rest of the body.",
    "Interesting: The shortest war in history was between Britain and Zanzibar on August 27, 1896. Zanzibar surrendered after 38 minutes.",
    "Cool fact: A group of flamingos is called a 'flamboyance'.",
    "Amazing: There are more possible iterations of a game of chess than there are atoms in the known universe."
  ]
};

function showAIKeyInput(){
  results.innerHTML = `
    <div class="card">
      <div class="swift-ai-header">
        <div class="swift-ai-icon">‚ú®</div>
        <h3 style="margin:0">Swift AI Setup</h3>
      </div>
      <p>For advanced AI capabilities, enter your Google Gemini API key (optional):</p>
      
      <div class="keybox">
        <input class="api-key-input" id="keyInput" placeholder="Enter AIza... (Optional)" value="${AI_API_KEY || ''}" />
        <button style="margin-top:10px; width:100%; border-radius:24px; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border:none; color:white; padding:10px;" onclick="saveAPIKey()">
          ${AI_API_KEY ? 'Update API Key' : 'Save API Key'}
        </button>
        ${!AI_API_KEY ? `
          <div style="margin-top:15px; padding:10px; background:#1f2937; border-radius:8px;">
            <p style="margin:0"><strong>No key needed for basic AI!</strong></p>
            <p style="margin:5px 0 0 0; font-size:0.9rem">Swift AI works without API key for common questions, jokes, calculations, and more.</p>
          </div>
        ` : ''}
      </div>
      
      <div class="note" style="margin-top:15px">
        <p><strong>Get a free API key:</strong></p>
        <ol style="margin:10px 0; padding-left:20px;">
          <li>Visit <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color:#8b5cf6">Google AI Studio</a></li>
          <li>Sign in with Google account</li>
          <li>Click "Create API Key"</li>
          <li>Copy and paste it here</li>
        </ol>
        <p>With API key: Advanced questions, detailed explanations, complex reasoning<br>
        Without API key: Basic questions, jokes, calculations, time, facts</p>
      </div>
      
      <div class="swift-ai-controls">
        <button class="swift-ai-btn" onclick="activateSwiftAI()">
          <span>‚ú®</span> Try Swift AI Now
        </button>
        ${AI_API_KEY ? `
          <button class="swift-ai-btn secondary" onclick="clearAPIKey()">
            <span>üóëÔ∏è</span> Remove API Key
          </button>
        ` : ''}
      </div>
    </div>
  `;
}

function saveAPIKey(){
  const key = document.getElementById("keyInput").value.trim();
  AI_API_KEY = key;
  localStorage.setItem("AI_API_KEY", key);
  updateClearKeyButton();
  
  results.innerHTML = `
    <div class="card">
      <div class="swift-ai-response">
        <div class="swift-ai-header">
          <div class="swift-ai-icon">‚ú®</div>
          <b>API Key Saved!</b>
        </div>
        <p>Swift AI is now enhanced with Google Gemini's advanced capabilities.</p>
        <div class="swift-ai-controls">
          <button class="swift-ai-btn" onclick="activateSwiftAI()">
            <span>‚ú®</span> Start Using Swift AI
          </button>
        </div>
      </div>
    </div>
  `;
}

function updateClearKeyButton(){
  if(AI_API_KEY){
    clearKeyBtn.innerHTML = `
      <button class="clear-key" onclick="clearAPIKey()">
        Remove API Key
      </button>
    `;
  }else{
    clearKeyBtn.innerHTML = '';
  }
}

function clearAPIKey(){
  localStorage.removeItem('AI_API_KEY');
  AI_API_KEY = "";
  updateClearKeyButton();
  showAIKeyInput();
}

/* ---------- SWIFT AI ASSISTANT ---------- */
async function swiftAIQuery(prompt){
  isAILoading = true;
  
  // Show thinking animation
  showThinkingAnimation();
  
  // First, try to get response from local knowledge base
  const localResponse = getLocalAIResponse(prompt);
  if(localResponse){
    isAILoading = false;
    return localResponse;
  }
  
  // If we have API key, try external AI
  if(AI_API_KEY){
    try{
      const apiResponse = await callExternalAI(prompt);
      isAILoading = false;
      return apiResponse;
    }catch(error){
      console.log("External AI failed, using enhanced local response");
    }
  }
  
  // Enhanced local response for complex queries
  const enhancedResponse = getEnhancedLocalResponse(prompt);
  isAILoading = false;
  return enhancedResponse;
}

function getLocalAIResponse(prompt){
  const q = prompt.toLowerCase().trim();
  
  // Check for greetings
  if(q.match(/^(hello|hi|hey|greetings|good morning|good afternoon|good evening)/)){
    return AI_KNOWLEDGE_BASE.greetings[Math.floor(Math.random() * AI_KNOWLEDGE_BASE.greetings.length)];
  }
  
  // Check for common questions
  for(const [question, answer] of Object.entries(AI_KNOWLEDGE_BASE.questions)){
    if(q.includes(question)){
      return answer;
    }
  }
  
  // Check for jokes
  if(q.includes("joke") || q.includes("funny") || q.includes("laugh")){
    return AI_KNOWLEDGE_BASE.jokes[Math.floor(Math.random() * AI_KNOWLEDGE_BASE.jokes.length)];
  }
  
  // Check for facts
  if(q.includes("fact") || q.includes("interesting") || q.includes("tell me something")){
    return AI_KNOWLEDGE_BASE.facts[Math.floor(Math.random() * AI_KNOWLEDGE_BASE.facts.length)];
  }
  
  // Check for thanks
  if(q.includes("thank") || q.includes("thanks")){
    return "You're welcome! Is there anything else I can help you with?";
  }
  
  // Check for help
  if(q.includes("help") || q.includes("what can you do")){
    return "I can help you with: answering questions, telling jokes, calculating math, getting the time, sharing interesting facts, and more! Just ask me anything.";
  }
  
  // Check for calculations
  if(q.includes("calculate") || q.match(/\d+[\+\-\*\/]\d+/) || q.includes("what is") && q.match(/\d/)){
    try{
      const mathExpr = q.replace(/calculate|what is|how much is|/gi, "").trim();
      const cleanExpr = mathExpr.replace(/[^-()\d/*+.]/g, '');
      if(cleanExpr){
        const result = eval(cleanExpr);
        return `The result of ${cleanExpr} is ${result}`;
      }
    }catch(e){
      return "I couldn't calculate that. Please try a simpler math expression like 'calculate 5 + 3' or 'what is 25 * 4'.";
    }
  }
  
  // Check for time
  if(q.includes("time") || q.includes("what time")){
    const now = new Date();
    return `The current time is ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}.`;
  }
  
  // Check for date
  if(q.includes("date") || q.includes("today's date") || q.includes("what day")){
    const now = new Date();
    return `Today is ${now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}.`;
  }
  
  return null; // No local response found
}

function getEnhancedLocalResponse(prompt){
  const q = prompt.toLowerCase().trim();
  
  // Generate context-aware responses
  if(q.includes("what is") || q.includes("what are") || q.includes("explain")){
    const topic = q.replace(/what is|what are|explain|tell me about|/gi, "").trim();
    if(topic){
      return `I understand you're asking about "${topic}". While I don't have detailed information about that specific topic right now, you can search for "${topic}" in the search bar above to get comprehensive information from the web.`;
    }
  }
  
  if(q.includes("how to") || q.includes("how do i")){
    const task = q.replace(/how to|how do i|/gi, "").trim();
    if(task){
      return `To "${task}", I recommend searching for step-by-step guides. You can search "${q}" in the search bar above to find detailed instructions and tutorials.`;
    }
  }
  
  if(q.includes("why") || q.includes("why is") || q.includes("why are")){
    const question = q.replace(/why|why is|why are|/gi, "").trim();
    if(question){
      return `That's an interesting question about "${question}". For detailed explanations, try searching "${q}" in the search bar.`;
    }
  }
  
  // Default enhanced response
  return `I understand you're asking about "${prompt}". For the best answer, you can search this in the search bar above. I can also help you with: telling jokes, calculating math, getting the time, sharing facts, or answering general questions. Would you like me to help you with something specific?`;
}

async function callExternalAI(prompt){
  try{
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${AI_API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{
            parts: [{
              text: `You are Swift AI, a helpful and friendly voice assistant. Respond conversationally to: "${prompt}". Keep responses concise, helpful, and under 3 sentences.`
            }]
          }]
        })
      }
    );
    
    if(!response.ok){
      throw new Error(`API error: ${response.status}`);
    }
    
    const data = await response.json();
    return data?.candidates?.[0]?.content?.parts?.[0]?.text || "I'm here to help! What else can I do for you?";
    
  }catch(error){
    console.error("External AI error:", error);
    throw error;
  }
}

function showThinkingAnimation(){
  const currentCard = document.querySelector('.card');
  if(currentCard){
    currentCard.innerHTML += `
      <div class="ai-thinking">
        <div class="typing-indicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
        <span>Swift AI is thinking...</span>
      </div>
    `;
  }
}

function activateSwiftAI(){
  swiftAiMode = true;
  swiftAiBtn.classList.add('active');
  input.placeholder = "Ask Swift AI anything...";
  input.focus();
  
  results.innerHTML = `
    <div class="card">
      <div class="swift-ai-response">
        <div class="swift-ai-header">
          <div class="swift-ai-icon">‚ú®</div>
          <b>Swift AI Activated</b>
        </div>
        <p>Hello! I'm Swift AI, your personal assistant. I can help you with:</p>
        <div class="command-examples">
          <div class="command-item">
            <span class="command-cmd">"What time is it?"</span>
            <span class="command-desc">- Get current time</span>
          </div>
          <div class="command-item">
            <span class="command-cmd">"Tell me a joke"</span>
            <span class="command-desc">- Have some fun</span>
          </div>
          <div class="command-item">
            <span class="command-cmd">"Calculate 25 * 4"</span>
            <span class="command-desc">- Math calculations</span>
          </div>
          <div class="command-item">
            <span class="command-cmd">"What's your name?"</span>
            <span class="command-desc">- Learn about me</span>
          </div>
          <div class="command-item">
            <span class="command-cmd">"Tell me a fact"</span>
            <span class="command-desc">- Interesting facts</span>
          </div>
          ${!AI_API_KEY ? `
          <div class="command-item">
            <span class="command-cmd" style="color:#10b981">"Add API key"</span>
            <span class="command-desc">- For advanced questions</span>
          </div>
          ` : ''}
        </div>
        <div class="swift-ai-controls">
          <button class="swift-ai-btn" onclick="startSwiftAIVoice()">
            <span>üé§</span> Voice Command
          </button>
          <button class="swift-ai-btn secondary" onclick="showAIKeyInput()">
            <span>‚öôÔ∏è</span> AI Settings
          </button>
          <button class="swift-ai-btn secondary" onclick="deactivateSwiftAI()">
            <span>üîç</span> Back to Search
          </button>
        </div>
      </div>
    </div>
  `;
}

function deactivateSwiftAI(){
  swiftAiMode = false;
  swiftAiBtn.classList.remove('active');
  input.placeholder = "Ask Swift AI, search, play music, or manage files...";
  results.innerHTML = showHistory();
}

async function handleSwiftAIQuery(query){
  const q = query.trim();
  if(!q) return;
  
  // Remove wake words
  const cleanQuery = q.replace(/hey swift|hello swift|okay swift/gi, "").trim();
  
  // Show loading state
  results.innerHTML = `
    <div class="card">
      <div class="swift-ai-response">
        <div class="swift-ai-header">
          <div class="swift-ai-icon">‚ú®</div>
          <b>Processing your request...</b>
        </div>
        <div class="ai-thinking">
          <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
          <span>Swift AI is thinking...</span>
        </div>
      </div>
    </div>
  `;
  
  // Get AI response
  const response = await swiftAIQuery(cleanQuery || q);
  
  // Speak the response
  speakSwiftAIResponse(response);
  
  // Show response
  results.innerHTML = `
    <div class="card">
      <div class="swift-ai-response">
        <div class="swift-ai-header">
          <div class="swift-ai-icon">‚ú®</div>
          <b>Swift AI</b>
        </div>
        <p>${response}</p>
        <div class="note">Speaking response...</div>
        <div class="swift-ai-controls">
          <button class="swift-ai-btn secondary" onclick="activateSwiftAI()">
            <span>‚ú®</span> Ask Another Question
          </button>
          <button class="swift-ai-btn secondary" onclick="speakSwiftAIResponse('${response.replace(/'/g, "\\'")}')">
            <span>üîä</span> Repeat Response
          </button>
        </div>
      </div>
    </div>
  `;
}

function speakSwiftAIResponse(text){
  if('speechSynthesis' in window){
    // Stop any ongoing speech
    speechSynthesis.cancel();
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = 1.0;
    utterance.pitch = 1.0;
    utterance.volume = 1.0;
    
    // Try to get a good voice
    const voices = speechSynthesis.getVoices();
    const preferredVoices = ['Google US English', 'Microsoft David', 'Alex', 'Samantha'];
    
    for(const voiceName of preferredVoices){
      const voice = voices.find(v => v.name.includes(voiceName));
      if(voice){
        utterance.voice = voice;
        break;
      }
    }
    
    speechSynthesis.speak(utterance);
  }
}

function startSwiftAIVoice(){
  if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const swiftRecognition = new SpeechRecognition();
    swiftRecognition.continuous = false;
    swiftRecognition.interimResults = false;
    swiftRecognition.lang = 'en-US';
    
    swiftAiStatus.style.display = 'flex';
    
    swiftRecognition.onresult = async (event) => {
      const transcript = event.results[0][0].transcript;
      input.value = transcript;
      swiftAiStatus.style.display = 'none';
      await handleSwiftAIQuery(transcript);
    };
    
    swiftRecognition.onerror = () => {
      swiftAiStatus.style.display = 'none';
    };
    
    swiftRecognition.onend = () => {
      swiftAiStatus.style.display = 'none';
    };
    
    swiftRecognition.start();
  }else{
    alert('Voice recognition not supported in your browser');
  }
}

/* ---------- SEARCH HISTORY ---------- */
let searchHistory = JSON.parse(localStorage.getItem("searchHistory")) || [];
let uploadedFiles = JSON.parse(localStorage.getItem("uploadedFiles")) || [];

function addToHistory(query){
  if(!query.trim()) return;
  
  searchHistory = searchHistory.filter(item => item.toLowerCase() !== query.toLowerCase());
  searchHistory.unshift(query);
  searchHistory = searchHistory.slice(0,10);
  
  localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
}

function showHistory(){
  if(searchHistory.length === 0 && uploadedFiles.length === 0) return '';
  
  let historyHTML = '';
  
  if(uploadedFiles.length > 0){
    historyHTML += `
      <div class="card">
        <b>Recent Files</b>
        ${uploadedFiles.slice(0, 3).map(file => `
          <div class="file-item" onclick="openFile('${file.name}')">
            <div class="file-name">üìÑ ${file.name}</div>
            <div class="file-size">${formatFileSize(file.size)}</div>
          </div>
        `).join('')}
      </div>
    `;
  }
  
  if(searchHistory.length > 0){
    const historyItems = searchHistory.map(item => `
      <div class="history-item" onclick="input.value='${item.replace(/'/g, "\\'")}'; handle('${item.replace(/'/g, "\\'")}')">
        ${item}
      </div>
    `).join('');
    
    historyHTML += `
      <div class="card">
        <b>Recent Searches</b>
        ${historyItems}
      </div>
    `;
  }
  
  return historyHTML;
}

function formatFileSize(bytes){
  if(bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

/* ---------- FILE SERVICES ---------- */
function openFileModal(){
  fileModal.style.display = 'flex';
  renderFileList();
}

function closeFileModal(){
  fileModal.style.display = 'none';
}

function searchOnService(service){
  const query = input.value.trim();
  if(query){
    switch(service){
      case 'googleDrive':
        window.open(`https://drive.google.com/drive/search?q=${encodeURIComponent(query)}`, '_blank');
        break;
      case 'dropbox':
        window.open(`https://www.dropbox.com/search/personal?query=${encodeURIComponent(query)}`, '_blank');
        break;
      case 'onedrive':
        window.open(`https://onedrive.live.com/?qt=search&q=${encodeURIComponent(query)}`, '_blank');
        break;
      case 'icloud':
        window.open(`https://www.icloud.com/#search=${encodeURIComponent(query)}`, '_blank');
        break;
    }
  }else{
    openService(service);
  }
  closeFileModal();
}

function openService(service){
  const urls = {
    wetransfer: 'https://wetransfer.com',
    figma: 'https://figma.com',
    github: 'https://github.com',
    notion: 'https://notion.so',
    googledrive: 'https://drive.google.com',
    dropbox: 'https://dropbox.com',
    onedrive: 'https://onedrive.live.com',
    icloud: 'https://icloud.com'
  };
  window.open(urls[service] || `https://${service}.com`, '_blank');
  closeFileModal();
}

/* ---------- FILE UPLOAD ---------- */
uploadArea.addEventListener('click', () => fileInput.click());

uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
  uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  const files = Array.from(e.dataTransfer.files);
  handleFiles(files);
});

fileInput.addEventListener('change', (e) => {
  const files = Array.from(e.target.files);
  handleFiles(files);
  fileInput.value = '';
});

function handleFiles(files){
  files.forEach(file => {
    const fileData = {
      name: file.name,
      size: file.size,
      type: file.type,
      lastModified: file.lastModified,
      preview: URL.createObjectURL(file)
    };
    
    uploadedFiles.unshift(fileData);
    if(uploadedFiles.length > 10) uploadedFiles.pop();
    
    localStorage.setItem("uploadedFiles", JSON.stringify(uploadedFiles));
  });
  
  renderFileList();
  
  results.innerHTML = `
    <div class="card">
      <b>üìÅ Files Uploaded</b>
      <p>Successfully uploaded ${files.length} file(s). You can access them in File Services.</p>
    </div>
  `;
}

function renderFileList(){
  fileList.innerHTML = uploadedFiles.length > 0 ? 
    uploadedFiles.slice(0, 5).map(file => `
      <div class="file-item">
        <div class="file-name">üìÑ ${file.name}</div>
        <div class="file-size">${formatFileSize(file.size)}</div>
        <div class="file-actions">
          <button class="file-action-btn" onclick="openFile('${file.name}')" title="Open">üîç</button>
          <button class="file-action-btn" onclick="removeFile('${file.name}')" title="Remove">üóëÔ∏è</button>
        </div>
      </div>
    `).join('') : 
    '<p class="note" style="text-align:center">No files uploaded yet</p>';
}

function openFile(filename){
  const file = uploadedFiles.find(f => f.name === filename);
  if(file && file.preview){
    window.open(file.preview, '_blank');
  }
}

function removeFile(filename){
  uploadedFiles = uploadedFiles.filter(f => f.name !== filename);
  localStorage.setItem("uploadedFiles", JSON.stringify(uploadedFiles));
  renderFileList();
}

/* ---------- MUSIC SERVICES ---------- */
function playOnYouTube(songQuery){
  window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(songQuery)}&sp=EgIQAQ%253D%253D`, "_blank");
}

function playOnYouTubeMusic(songQuery){
  window.open(`https://music.youtube.com/search?q=${encodeURIComponent(songQuery)}`, "_blank");
}

function playOnSpotify(songQuery){
  window.open(`https://open.spotify.com/search/${encodeURIComponent(songQuery)}`, "_blank");
}

function parseMusicQuery(query){
  const patterns = [
    /play\s+"(.+?)"\s+by\s+(.+)/i,
    /play\s+(.+?)\s+by\s+(.+)/i,
    /play\s+(.+)\s+on\s+(.+)/i,
    /play\s+(.+)/i
  ];
  
  for(const pattern of patterns){
    const match = query.match(pattern);
    if(match){
      if(pattern.toString().includes('by')){
        return {
          song: match[1].trim(),
          artist: match[2].trim(),
          fullQuery: `${match[1].trim()} ${match[2].trim()}`
        };
      }else{
        return {
          song: match[1].trim(),
          artist: '',
          fullQuery: match[1].trim()
        };
      }
    }
  }
  
  return {
    song: query.replace(/^play\s+/i, '').trim(),
    artist: '',
    fullQuery: query.replace(/^play\s+/i, '').trim()
  };
}

/* ---------- LOADING STATES ---------- */
function showLoading(){
  results.innerHTML = `
    <div class="card">
      <b>Searching...</b>
      <div class="loading-spinner"></div>
    </div>
  `;
}

/* ---------- VOICE SEARCH ---------- */
let isListening = false;
let recognition = null;

if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-US';
  
  recognition.onstart = () => {
    isListening = true;
    voiceBtn.classList.add('listening');
    voiceStatus.style.display = 'flex';
  };
  
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    input.value = transcript;
    handle(transcript);
  };
  
  recognition.onerror = (event) => {
    console.error('Speech recognition error:', event.error);
    if(event.error === 'not-allowed'){
      alert('Microphone access denied. Please allow microphone access to use voice search.');
    }
  };
  
  recognition.onend = () => {
    isListening = false;
    voiceBtn.classList.remove('listening');
    voiceStatus.style.display = 'none';
  };
  
  voiceBtn.addEventListener('click', () => {
    if(isListening){
      recognition.stop();
    }else{
      try{
        recognition.start();
      }catch(error){
        console.error('Speech recognition start error:', error);
        alert('Voice search is not available. Please check your microphone permissions.');
      }
    }
  });
  
  voiceBtn.title = 'Voice Search (Click to start/stop)';
}else{
  voiceBtn.style.display = 'none';
}

/* ---------- BUTTON HANDLERS ---------- */
textSearchBtn.addEventListener('click', () => {
  if(input.value.trim()){
    handle(input.value);
  }else{
    input.focus();
  }
});

swiftAiBtn.addEventListener('click', () => {
  if(swiftAiMode){
    deactivateSwiftAI();
  }else{
    activateSwiftAI();
  }
});

fileSearchBtn.addEventListener('click', openFileModal);

mainSearchBtn.addEventListener('click', () => {
  if(input.value.trim()){
    handle(input.value);
  }else{
    input.focus();
  }
});

/* ---------- MAIN HANDLER ---------- */
async function handle(query){
  const q = query.trim();
  if(!q) return;
  
  addToHistory(query);
  
  // Check if Swift AI mode is active or query contains wake word
  if(swiftAiMode || q.toLowerCase().includes("hey swift") || q.toLowerCase().includes("okay swift")){
    await handleSwiftAIQuery(q);
    return;
  }
  
  results.innerHTML = showHistory();
  showLoading();
  
  const lowerQuery = q.toLowerCase();
  
  /* üéµ MUSIC INTENT */
  if(lowerQuery.startsWith("play ")){
    const musicData = parseMusicQuery(q);
    const songQuery = musicData.fullQuery;
    
    results.innerHTML = `
      <div class="card">
        <b>üéµ Play: ${songQuery}</b>
        ${musicData.artist ? `<p class="note">Artist: ${musicData.artist}</p>` : ''}
        <div class="music-options">
          <button class="music-btn" onclick="playOnSpotify('${songQuery.replace(/'/g, "\\'")}')">Spotify</button>
          <button class="music-btn" onclick="playOnYouTubeMusic('${songQuery.replace(/'/g, "\\'")}')">YouTube Music</button>
          <button class="music-btn" onclick="playOnYouTube('${songQuery.replace(/'/g, "\\'")}')">YouTube</button>
        </div>
        <p class="note" style="margin-top:10px;">Auto-playing on Spotify...</p>
      </div>
    `;
    
    setTimeout(() => playOnSpotify(songQuery), 500);
    return;
  }
  
  /* üìÅ FILE SEARCH INTENT */
  if(lowerQuery.startsWith("find ") || lowerQuery.startsWith("search ") || 
     lowerQuery.includes("file") || lowerQuery.includes("document")){
    
    if(lowerQuery.includes("drive") || lowerQuery.includes("google")){
      window.open(`https://drive.google.com/drive/search?q=${encodeURIComponent(q)}`, "_blank");
      results.innerHTML = `<div class="card">Searching Google Drive for: ${q}</div>`;
      return;
    }
    
    if(lowerQuery.includes("dropbox")){
      window.open(`https://www.dropbox.com/search/personal?query=${encodeURIComponent(q)}`, "_blank");
      results.innerHTML = `<div class="card">Searching Dropbox for: ${q}</div>`;
      return;
    }
    
    // General file search - show file services
    openFileModal();
    return;
  }
  
  /* DIRECT SERVICES */
  if(lowerQuery.includes("youtube") && !lowerQuery.includes("youtube music")){
    window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`, "_blank");
    results.innerHTML = `<div class="card">Opening YouTube for: ${q}</div>`;
    return;
  }
  
  if(lowerQuery.includes("spotify")){
    window.open(`https://open.spotify.com/search/${encodeURIComponent(q)}`, "_blank");
    results.innerHTML = `<div class="card">Opening Spotify for: ${q}</div>`;
    return;
  }
  
  if(lowerQuery.includes("gmail") || lowerQuery.includes("email")){
    window.open("https://mail.google.com", "_blank");
    results.innerHTML = `<div class="card">Opening Gmail</div>`;
    return;
  }
  
  if(lowerQuery.startsWith("open ")){
    const site = q.replace("open ", "").replace(/\s+/g, "");
    window.open(`https://${site}.com`, "_blank");
    results.innerHTML = `<div class="card">Opening ${site}.com</div>`;
    return;
  }
  
  /* WEB SEARCH */
  window.open(`https://www.google.com/search?q=${encodeURIComponent(q)}`, "_blank");
  results.innerHTML = `
    <div class="card">
      <b>Web Search Results</b>
      <p>Search results for "${q}" have been opened in a new tab.</p>
      <div class="swift-ai-controls">
        <button class="swift-ai-btn" onclick="activateSwiftAI()">
          <span>‚ú®</span> Ask Swift AI about this
        </button>
      </div>
    </div>
  `;
}

/* ---------- KEYBOARD SHORTCUTS ---------- */
input.addEventListener("keydown", e => {
  if(e.key === "Enter"){
    handle(input.value);
  }
  
  if(e.key === "/"){
    e.preventDefault();
    input.focus();
    input.select();
  }
  
  if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "l"){
    e.preventDefault();
    input.focus();
    input.select();
  }
  
  if(e.key === "Escape"){
    if(isListening && recognition){
      recognition.stop();
    }
    input.value = "";
    input.blur();
    if(swiftAiMode){
      deactivateSwiftAI();
    }
  }
  
  if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "f"){
    e.preventDefault();
    openFileModal();
  }
  
  if((e.ctrlKey || e.metaKey) && e.key === " "){
    e.preventDefault();
    activateSwiftAI();
  }
});

document.addEventListener('keydown', (e) => {
  if(e.key === ' ' && isListening && recognition){
    e.preventDefault();
    recognition.stop();
  }
});

/* ---------- INITIALIZE ---------- */
updateClearKeyButton();
renderFileList();

// Load voices for speech synthesis
if('speechSynthesis' in window){
  speechSynthesis.getVoices();
}

// Show welcome message on first load
setTimeout(() => {
  if(searchHistory.length === 0 && uploadedFiles.length === 0){
    results.innerHTML = `
      <div class="card">
        <div class="swift-ai-response">
          <div class="swift-ai-header">
            <div class="swift-ai-icon">‚ú®</div>
            <b>Welcome to Swift Search!</b>
          </div>
          <p>I'm Swift AI, your personal assistant. Try asking me:</p>
          <div class="command-examples">
            <div class="command-item">
              <span class="command-cmd">"What time is it?"</span>
              <span class="command-desc">- Get current time</span>
            </div>
            <div class="command-item">
              <span class="command-cmd">"Tell me a joke"</span>
              <span class="command-desc">- Have some fun</span>
            </div>
            <div class="command-item">
              <span class="command-cmd">"Calculate 15 + 27"</span>
              <span class="command-desc">- Math calculations</span>
            </div>
            <div class="command-item">
              <span class="command-cmd">"Play Bohemian Rhapsody"</span>
              <span class="command-desc">- Music playback</span>
            </div>
          </div>
          <div class="swift-ai-controls">
            <button class="swift-ai-btn" onclick="activateSwiftAI()">
              <span>‚ú®</span> Activate Swift AI
            </button>
            <button class="swift-ai-btn secondary" onclick="showAIKeyInput()">
              <span>‚öôÔ∏è</span> AI Settings
            </button>
          </div>
        </div>
      </div>
    `;
  }else{
    results.innerHTML = showHistory();
  }
  input.focus();
}, 100);

// Close modal when clicking outside
fileModal.addEventListener('click', (e) => {
  if(e.target === fileModal){
    closeFileModal();
  }
});
</script>

</body>
</html>
